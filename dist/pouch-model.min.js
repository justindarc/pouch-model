!function(a,b,c){"use strict";Object.keys=Object.keys||function(a,b,c){c=[];for(b in a)c.hasOwnProperty.call(a,b)&&c.push(b);return c},Array.prototype.find||function(){var a=function(a){var b=Object(this),c=b.length<0?0:b.length>>>0;if(0===c)return void 0;if("function"!=typeof a||"[object Function]"!==Object.prototype.toString.call(a))throw new TypeError("Array#find: predicate must be a function");for(var d,e=arguments[1],f=0;c>f;f++)if(d=b[f],a.call(e,d,f,b))return d;return void 0};if(Object.defineProperty)try{Object.defineProperty(Array.prototype,"find",{value:a,configurable:!0,enumerable:!1,writable:!0})}catch(b){}Array.prototype.find=Array.prototype.find||a}(),function(a){a.matchesSelector=a.matchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector||a.webkitMatchesSelector||function(a){for(var b=this,c=(b.parentNode||b.document).querySelectorAll(a),d=-1;c[++d]&&c[d]!==b;);return!!c[d]}}(Element.prototype),b.module("pouch-model",[]);var d=b.$$minErr("$pouchModel");b.module("pouch-model").provider("$pouchModelDatabase",function(){var a={name:"pouch-model",options:{}};return{setup:function(b,c){a.name=b||a.name,a.options=c||a.options},$get:[function(){var b=null;return{get:function(){if(b)return b;var c=a.name||a.options.name;return a.options.adapter?b=new PouchDB(c,a.options):PouchDB.adapters.websql?(a.options.adapter="websql",b=new PouchDB(c,a.options)):b=new PouchDB(c,a.options)},destroy:function(){PouchDB.destroy(a.name||a.options.name),b=null}}}]}}),b.module("pouch-model").provider("$pouchModelSync",function(){var a={concurrent:{local:10,remote:2},maxRetries:10},c=b.forEach,d=b.isFunction,e=function(){function b(a,b){this.operations=[],this.processing=[],this.failures=[],this.adapterType=a,this.concurrent=b||1;var c=!1;this.isPaused=function(){return c},this.pause=function(){c=!0},this.start=function(){c=!1,this.process()}}var c=function(a,b){var c=a.model.updated_at,d=b.model.updated_at;return c>d?1:d>c?-1:0};return b.prototype.constructor=b,b.prototype.process=function(){var b=this.processing;if(!(this.isPaused()||b.length>=this.concurrent)){var c=this.operations.shift();if(c||(this.operations=this.operations.concat(this.failures),c=this.operations.shift())){b.push(c);var e=this,f=c.type,g=(c.source,c.model),h=g.constructor.adapters[c.targetAdapter],i=h[f],j=function(){for(var a=0,d=b.length;d>a;a++)if(b[a]===c)return void b.splice(a,1)};g.trigger("before","sync"),i(g.getEscapedProperties()).then(function(a){g.trigger("after","sync"),d(c.success)&&c.success.call(c,a),j(),e.process()}).catch(function(b){b=b||{},g.trigger("failed","sync"),d(c.error)&&c.error.call(c,b),j(),b.deleted?e.enqueue({type:"delete",sourceAdapter:c.targetAdapter,targetAdapter:c.sourceAdapter,model:g},c.success,c.error):(c.fail=(c.fail||0)+1,a.maxRetries>c.fail&&e.failures.push(c)),e.process()})}}},b.prototype.enqueue=function(a,b,d){if(!this.isQueued(a)){a.success=b,a.error=d;var e=this.operations;e.push(a),e.sort(c),this.process()}},b.prototype.isQueued=function(a){var b=a.type,c=a.model,d=function(a){if(a.type!==b)return!1;var d=a.model;return d.id===c.id&&d.updated_at===c.updated_at};return!!this.operations.find(d)||!!this.processing.find(d)||!!this.failures.find(d)},b}();return{setup:function(c){b.extend(a,c)},$get:["$http",function(){var b={local:new e("local",a.concurrent.local),remote:new e("remote",a.concurrent.remote)};return{getLocalQueue:function(){return b.local},getRemoteQueue:function(){return b.remote},addToLocalQueue:function(a,b,c){this.getLocalQueue().enqueue(a,b,c)},addToRemoteQueue:function(a,b,c){this.getRemoteQueue().enqueue(a,b,c)},sync:function(a,b,d){var e=this;c(a.local,function(a){e.addToLocalQueue(a,b,d)}),c(a.remote,function(a){e.addToRemoteQueue(a,b,d)})}}}]}}),b.module("pouch-model").factory("$pouchModel",["$q","$timeout","$http","$pouchModelDatabase","$pouchModelSync",function(a,e,f,g,h){function i(a,b){this.template=a,this.defaults=b||{}}var j="\x00",k="_pouch_model_",l=["_id","_rev","_attachments"],m=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,n=(b.noop,b.forEach),o=b.equals,p=b.extend,q=b.copy,r=b.isDate,s=b.isFunction,t=b.isNumber,u=b.isObject,v=b.isString,w=(b.toJson,b.fromJson,PouchDB.utils.MD5),x=function(a){return a instanceof Array},y=function(a,b){return PouchDB.utils.uuid(a,b).toLowerCase()},z=g.get(),A=function(a,b){var c={_id:"_design/"+a,views:{}},e=b.toString();c.views[a]={map:e},z.put(c).then(function(){z.query(a,{stale:"update_after"}).then(function(){z.viewCleanup()})}).catch(function(){z.get("_design/"+a).then(function(b){var f=(b.views||{})[a]||{};f.map!==e&&z.remove(b._id,b._rev).then(function(){z.put(c).then(function(){z.query(a,{stale:"update_after"}).then(function(){z.viewCleanup()})}).catch(function(){throw d("design","Unable to save design document")})})})})},B=function(a,b){if(-1!==l.indexOf(b)||"_"!==b.charAt(0))return b;var c=j+b;return a[c]=a[b],delete a[b],c},C=function(a,b){if(b.charAt(0)!==j)return b;var c=b.substring(1);return a[c]=a[b],delete a[b],c},D=function(a){if(!u(a))return null;var b=Object.keys(a);return n(b,function(b){b=B(a,b),r(a[b])&&(a[b]=a[b].toISOString())}),a},E=function(a){if(!u(a))return null;var b=Object.keys(a);return n(b,function(b){b=C(a,b),v(a[b])&&m.test(a[b])&&(a[b]=new Date(a[b]))}),a},F=function(a,b){switch(a){case"boolean":return b===!0||b===!1?b:b?!!b:null;case"date":return r(b)?b:b?new Date(b):null;case"number":return t(b)?b:b?parseFloat(b):null;case"string":return v(b)?b:b?""+b:null}return b},G=function(a,b){var c=null;return n(b,function(b,d){var e=a[d],f=b;return u(f)||u(e)?void(r(f)&&r(e)&&e.getTime()!==f.getTime()&&((c||(c={}))[d]={from:e,to:f})):void(e!==f&&((c||(c={}))[d]={from:e,to:f}))}),c},H=function(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,b?"%20":"+")},I=function(a){return H(a,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")},J=function(a){var b,c,d={};for(b in a)c=a[b],d[b]=c===!0?1:c===!1?0:c;return d};i.prototype.constructor=i,i.prototype.createRequestConfig=function(a,c,e){var f,g,h={},i={},j=this.defaults;return h.method=a,e=e||this.template,n(e.split(/\W/),function(a){if("hasOwnProperty"===a)throw d("badname","hasOwnProperty is not a valid parameter name.");!new RegExp("^\\d+$").test(a)&&a&&new RegExp("(^|[^\\\\]):"+a+"(\\W|$)").test(e)&&(i[a]=!0)}),e=e.replace(/\\:/g,":"),c=c||{},n(i,function(a,d){f=c.hasOwnProperty(d)?c[d]:j[d],b.isDefined(f)&&null!==f?(g=I(f),e=e.replace(new RegExp(":"+d+"(\\W|$)","g"),function(a,b){return g+b})):e=e.replace(new RegExp("(/?):"+d+"(\\W|$)","g"),function(a,b,c){return"/"==c.charAt(0)?c:b+c})}),e=e.replace(/\/+$/,"")||"/",e=e.replace(/\/\.(?=\w+($|\?))/,"."),h.url=e.replace(/\/\\\./,"/."),"GET"===a&&(h.params={},n(c,function(a,b){i[b]||(h.params[b]=a)}),h.params=J(h.params)),h};var K=function(g,l){function m(a,b){this.push.apply(this,a),this.params=b}function r(a,b){var c=this;n(g.properties,function(a,b){var d=a["default"];c[b]=s(d)?d.call(c):d}),this._type=t,this._scope=I,this._attachments={},u(a)?(p(this,a),b=!!b):b=!!a;var d=this.getProperties();this.trigger("after","initialize"),this.isRemote=function(){return b},this.getPreviousProperties=function(){return d}}l=l||{};var t=g.title=g.title||g.type;if(delete g.type,!t)throw d("PouchModel","The `schema` must define a `type` or `title` attribute");g.properties=g.properties||{};var v=l.adapters||{},w=v.primary=v.primary||"local",B=v.secondary=v.secondary||"remote",C=v.primary,G=!(!l.sync||!l.url),H=!!l.singular,I=l.scope;n(g.properties,function(a){a.type=a.type||"string"});var J={},K=function(a){var b=k+t;return a?b+"_"+a.sort().join(","):b},L=function(a,b){var c=["doc['"+j+"_scope']"];x(a)?n(a,function(a){c.push("doc['"+a+"']")}):b=!!a;var d=new Function("return function(doc) {if (doc['"+j+"_type'] === '"+t+"') {emit(pouchCollate.toIndexableString(["+c.join(",")+"]));}}")();return b?d.toString():d},M=function(a){if(!N(a)){var b=J[a.sort().join(",")]=K(a);A(b,L(a,!0))}},N=function(a){return!!J[a.sort().join(",")]};A(K(),L(!0)),n(["created_at","updated_at","deleted_at"],function(a){M([a])}),n(g.properties,function(a,b){a.indexed&&M([b])}),n(l.indexes||[],function(a){x(a)||(a=[a]),M(a)});var O=l.url?new i(l.url):null,P=function(a,b){var c=[],d=[];x(a)||(a=a?[a]:[]),x(b)||(b=b?[b]:[]),n(b,function(b){var d=a.find(function(a){return H||a.id===b.id});if(!d&&!b.deleted_at)return H&&(b.id=d.id),c.push({type:"create",sourceAdapter:B,targetAdapter:w,model:b});if(d)return b.deleted_at?(H&&(b.id=d.id),c.push({type:"delete",sourceAdapter:B,targetAdapter:w,model:b})):b.updated_at&&d.updated_at&&b.updated_at.getTime()>d.updated_at.getTime()?(H&&(b.id=d.id),c.push({type:"update",sourceAdapter:B,targetAdapter:w,model:b})):void 0}),n(a,function(a){var c=b.find(function(b){return H||b.id===a.id});if(!c&&!a.deleted_at)return H&&(a.id=c.id),d.push({type:"create",sourceAdapter:w,targetAdapter:B,model:a});if(c)return a.deleted_at?(H&&(a.id=c.id),d.push({type:"delete",sourceAdapter:w,targetAdapter:B,model:a})):a.updated_at&&c.updated_at&&a.updated_at.getTime()>c.updated_at.getTime()?(H&&(a.id=c.id),d.push({type:"update",sourceAdapter:w,targetAdapter:B,model:a})):void 0});var e={};return e[w]=c,e[B]=d,e};m.prototype=Object.create(Array.prototype),m.prototype.constructor=m,m.prototype.refresh=function(b,c){var e=this,f=a.defer();return r.query(this.params,function(a){for(;e.length>0;)e.pop();e.push.apply(e,a),s(b)&&b.call(r,e),f.resolve(e)},function(a){throw s(c)&&c.call(r,a),f.reject(a),d("refresh","Unable to complete operation")}),f.promise},r.prototype.constructor=r,r.callbacks={before:{change:[],save:[],create:[],update:[],"delete":[],sync:[]},failed:{change:[],save:[],create:[],update:[],"delete":[],sync:[]},after:{change:[],save:[],create:[],update:[],"delete":[],sync:[],initialize:[]}},r.on=function(a,b,c){var d=r.callbacks[a];return s(c)&&d&&d[b]&&d[b].push(c),r},r.off=function(a,b,c){var d=r.callbacks[a];if(d){var e=d[b];if(e)if(s(c)){for(var f=0,g=e.length;g>f;f++)if(e[f]===c)return void e.splice(f,1)}else for(;e.length>0;)e.pop()}},r.wrap=function(a,b){if(!a)return null;if(!x(a))return new r(a,b);for(var c=[],d=0,e=a.length;e>d;d++)c.push(r.wrap(a[d],b));return c},r.isSingular=function(){return H},r.getSchema=function(){return g},r.getIndexes=function(){return J},r.getAdapter=function(){return C},r.setAdapter=function(a){C=a},r.useAdapter=function(a,b){var c,d=C;return C=a,s(b)&&(c=b.call(r)),C=d,c},r.getScope=function(){return I},r.setScope=function(a){I=a},r.useScope=function(a,b){var c,d=I;return I=a,s(b)&&(c=b.call(r)),I=d,c},r.query=function(b,c,f){if(H)throw d("query","Cannot query singular models");var g=a.defer(),i=r.adapters[C],j=C===w,k="remote"===C,l=i.query;return b=b||{},s(b)&&(f=c,c=b,b={}),l(b).then(function(a){var d=r.wrap(a.map(function(a){return E(a)}),k),f=new m(d.filter(function(a){return!a.isDeleted()}),b);s(c)&&c.call(r,f),g.resolve(f),G&&j&&e(function(){r.useAdapter(B,function(){r.query(b,function(a){var b=P(d,a);h.sync(b,function(){f.refresh()})})})})}).catch(function(a){s(f)&&f.call(r,a),g.reject(a)}),g.promise},r.get=function(b,c,f){var g=a.defer(),i=r.adapters[C],j=C===w,k="remote"===C,l=i.get;if(H){if(b&&!s(b))throw d("get","Cannot specify params for singular models");f=c,c=b,b={}}else if(!b||s(b))throw d("get","No params specified");return l(b).then(function(a){if(H&&!a)return function(){var a=new r;a.$create().then(function(a){s(c)&&c.call(r,a),g.resolve(a)}).catch(function(a){s(f)&&f.call(r,a),g.reject(a)})}();var d=E(a),i=r.wrap(d,k);s(c)&&c.call(r,i),g.resolve(i),G&&j&&e(function(){r.useAdapter(B,function(){var a=function(a){p(i,a.getProperties())};H?r.get(function(b){var c=P(i,b);h.sync(c,function(){r.get(a)})}):r.get(b,function(c){var d=P(i,c);h.sync(d,function(){r.get(b,a)})})})})}).catch(function(a){s(f)&&f.call(r,a),g.reject(a)}),g.promise},r.adapters={local:{query:function(b){var c=a.defer(),d=Object.keys(b).sort();if(0===d.length)return z.query(K(),{include_docs:!0,key:pouchCollate.toIndexableString([I])}).then(function(a){c.resolve(a.rows.map(function(a){return a.doc}))}).catch(c.reject),c.promise;var e=pouchCollate.toIndexableString([I].concat(d.map(function(a){return b[a]})));return N(d)?(z.query(K(d),{include_docs:!0,key:e}).then(function(a){c.resolve(a.rows.map(function(a){return a.doc}))}).catch(c.reject),c.promise):(console.warn("Non-indexed queries can result in poor performance",b),z.query(L(d),{include_docs:!0,key:e}).then(function(a){c.resolve(a.rows.map(function(a){return a.doc}))}).catch(c.reject),c.promise)},get:function(b){var c=a.defer(),d=Object.keys(b).sort();if(0===d.length)return z.query(K(),{include_docs:!0,limit:1,key:pouchCollate.toIndexableString([I])}).then(function(a){c.resolve(a.rows[0]&&a.rows[0].doc)}).catch(c.reject),c.promise;if(1===d.length){if("_id"===d[0])return z.get(b._id).then(c.resolve).catch(c.reject),c.promise;if("id"===d[0])return z.get([t,I,b.id].join(j)).then(c.resolve).catch(c.reject),c.promise}var e=pouchCollate.toIndexableString([I].concat(d.map(function(a){return b[a]})));return N(d)?(z.query(K(d),{include_docs:!0,limit:1,key:e}).then(function(a){c.resolve(a.rows[0]&&a.rows[0].doc)}).catch(c.reject),c.promise):(console.warn("Non-indexed queries can result in poor performance",b),z.query(L(d),{include_docs:!0,limit:1,key:e}).then(function(a){c.resolve(a.rows[0]&&a.rows[0].doc)}).catch(c.reject),c.promise)},getAttachment:function(b,c){var d=a.defer();return z.getAttachment(b._id,c).then(d.resolve).catch(d.reject),d.promise},create:function(b){{var c=a.defer(),d=b[j+"_type"],e=b[j+"_scope"];b._attachments}delete b._attachments;{var f=b.id=b.id||y();b._id=b._id||[d,e,f].join(j)}return z.put(b).then(function(a){b._rev=a.rev,c.resolve(b)}).catch(c.reject),c.promise},update:function(b){{var c=a.defer(),d=b[j+"_type"],e=b[j+"_scope"];b._attachments}delete b._attachments;var f=b._id||[d,e,b.id].join(j);return z.get(f).then(function(a){b._id=a._id,b._rev=a._rev,z.put(b).then(function(a){b._rev=a.rev,c.resolve(b)}).catch(c.reject)}).catch(c.reject),c.promise},updateAttachment:function(b,c,d,e,f){var g=a.defer();return z.putAttachment(b._id,c,b._rev,d,f).then(g.resolve).catch(g.reject),g.promise},"delete":function(b){{var c=a.defer(),d=b[j+"_type"],e=b[j+"_scope"];b._attachments}delete b._attachments;var f=b._id||[d,e,b.id].join(j);return z.get(f).then(function(a){b._id=a._id,b._rev=a._rev,b.deleted_at=new Date,z.put(b).then(function(a){b._rev=a.rev,c.resolve(b)}).catch(c.reject)}).catch(c.reject),c.promise},deleteAttachment:function(b,c){var d=a.defer();return z.removeAttachment(b._id,c,b._rev).then(d.resolve).catch(d.reject),d.promise}},remote:{query:function(b){var c=a.defer(),d=O.createRequestConfig("GET",b);return f(d).success(function(a){c.resolve(a)}).error(function(a,b,d,e){c.reject({data:a,status:b,headers:d,config:e})}),c.promise},get:function(b){var c=a.defer(),d=O.createRequestConfig("GET",b);return f(d).success(function(a){c.resolve(a)}).error(function(a,b,d,e){c.reject({data:a,status:b,headers:d,config:e})}),c.promise},getAttachment:function(b,c){var d=a.defer(),f=g.properties[c],h=f.url?new i(f.url):null;if(h||(h=l.url?new i(l.url+"/"+c):null),!h)return e(function(){d.reject(null)}),d.promise;var j=h.createRequestConfig("GET",b);return e(function(){d.resolve(j.url)}),d.promise},create:function(b){var c=a.defer();b.id=b.id||y();var d=O.createRequestConfig("PUT",b);return d.data=b,f(d).success(c.resolve).error(function(a,b,d,e){return 410===b?void c.reject({deleted:!0}):void c.reject(a,b,d,e)}),c.promise},update:function(b){var c=a.defer(),d=O.createRequestConfig("PUT",b);return d.data=b,f(d).success(c.resolve).error(c.reject),c.promise},updateAttachment:function(d,e,g,h){var i=a.defer(),j=new FormData;j.append(e,g,h);var k=O.createRequestConfig("PUT",d);return k.data=j,k.headers={"Content-Type":c},k.transformRequest=b.identity,f(k).success(i.resolve).error(i.reject),i.promise},"delete":function(b){var c=a.defer(),d=O.createRequestConfig("DELETE",b);return f(d).success(c.resolve).error(function(a,b,d,e){return 404===b?void c.resolve(a,b,d,e):void c.reject(a,b,d,e)}),c.promise},deleteAttachment:function(){var b=a.defer();return console.warn("[PouchModel.adapters.remote.deleteAttachment]","not implemented"),b.promise}}};var Q=function(b,c,e,f,g,h,i){var j=a.defer();g.call(b);var k=b.isRemote()?r.adapters.remote:r.adapters.local,l=k[c],m=b.getEscapedProperties(),o=m._attachments;return delete m._attachments,l(m).then(function(a){h.call(b,a),q(b.getProperties(),b.getPreviousProperties()),s(e)&&e.call(b,a),j.resolve(a),"delete"!==c&&n(o,function(b,c){if(b&&b.isNew){var d=b.blob,e=b.name,f=b.type;k.updateAttachment(a,c,d,e,f).then(function(a){console.log(a)}).catch(function(a){console.warn(a)})}})}).catch(function(a){throw i.call(b,a),s(f)&&f.call(b,a),j.reject(a),d(c,"Unable to complete operation")}),j.promise};return r.prototype.$save=function(){var a=this.isNew()?this.$create:this.$update;return a.apply(this,arguments)},r.prototype.$create=function(a,b){if(!this.isNew())throw d("create","Model has already been created");var c=function(){this.trigger("before","change"),this.trigger("before","create"),this.trigger("before","save");var a=new Date;this.created_at=a,this.updated_at=a,this.deleted_at=null},e=function(){this.trigger("after","change"),this.trigger("after","create"),this.trigger("after","save")},f=function(){delete this.created_at,delete this.updated_at,delete this.deleted_at,this.trigger("failed","change"),this.trigger("failed","create"),this.trigger("failed","save")};return Q(this,"create",a,b,c,e,f)},r.prototype.$update=function(a,b){if(this.isNew())throw d("update","Model has not been created");var c=this.updated_at,e=function(){this.trigger("before","change"),this.trigger("before","update"),this.trigger("before","save");var a=new Date;this.updated_at=a},f=function(){this.trigger("after","change"),this.trigger("after","update"),this.trigger("after","save")},g=function(){this.updated_at=c,this.trigger("failed","change"),this.trigger("failed","update"),this.trigger("failed","save")};return Q(this,"update",a,b,e,f,g)},r.prototype.$delete=function(a,b){if(this.isNew())throw d("delete","Model has not been created");var c=this.updated_at,e=function(){this.trigger("before","change"),this.trigger("before","delete");var a=new Date;this.updated_at=a,this.deleted_at=a},f=function(){this.trigger("after","change"),this.trigger("after","delete")},g=function(){this.updated_at=c,this.deleted_at=null,this.trigger("failed","change"),this.trigger("failed","delete")};return Q(this,"delete",a,b,e,f,g)},r.prototype.$remove=r.prototype.$delete,r.prototype.getType=function(){return t},r.prototype.trigger=function(a,b){var c=this;n(r.callbacks[a][b],function(d){d.call(c,c,a,b)})},r.prototype.getProperties=function(){var a={},b=this;return n(b,function(c,d){("id"===d||"_"===d.charAt(0))&&(a[d]=b[d])}),n(["created_at","updated_at","deleted_at"],function(c){a[c]=F("date",b[c])}),n(g.properties,function(c,d){a[d]=F(c.type,b[d])}),a},r.prototype.getEscapedProperties=function(){return D(this.getProperties())},r.prototype.reset=function(){p(this,this.getPreviousProperties())},r.prototype.getAttachment=function(b,c,e){if(!g.properties[b])throw d("getAttachment","Specified `property` not defined in schema");if("file"!==g.properties[b].type)throw d("getAttachment","Specified `property` is not of type `file`");var f=a.defer(),h=this,i=this.isRemote()?r.adapters.remote:r.adapters.local;return i.getAttachment(this.getEscapedProperties(),b).then(function(a){var b=a instanceof Blob?URL.createObjectURL(a):a;s(c)&&c.call(h,b),f.resolve(b)}).catch(function(a){throw s(e)&&e.call(h,a),f.reject(a),d("getAttachment","Unable to complete operation")}),f.promise},r.prototype.setAttachment=function(b,c,e,f){if(!g.properties[b])throw d("setAttachment","Specified `property` not defined in schema");if("file"!==g.properties[b].type)throw d("setAttachment","Specified `property` is not of type `file`");if(!c)throw d("setAttachment","Invalid `blob` provided");var e=(a.defer(),this.isRemote()?r.adapters.remote:r.adapters.local,e||c.name||"blob"),f=f||c.type||"application/octet-stream";this._attachments[b]={blob:c,name:e,type:f,isNew:!0}},r.prototype.validate=function(){return tv4.validateResult(this,g)},r.prototype.isValid=function(){return this.validate().valid},r.prototype.isNew=function(){return!this.created_at},r.prototype.isDeleted=function(){return!!this.deleted_at},r.prototype.isDirty=function(){var a=this.getPreviousProperties(),b=this.getProperties();return!o(a,b)},r};return K.utils={MD5:w,UUID:y,diff:G},K}]),b.module("pouch-model").directive("pmAttachment",function(){return{restrict:"A",scope:{ngModel:"="},link:function(a,c,e){if(!c[0]||!c[0].matchesSelector('input[type="file"]'))throw d("pmAttachment",'Element must be `input[type="file"]`');var f=function(){c.val("")};a.$watch("ngModel",f),c.on("change",function(c){var f=a.ngModel;if(!f||!b.isFunction(f.setAttachment))throw d("pmAttachment","No valid `ngModel` found in scope");var g=e.pmAttachment,h=c.target.files[0];f.setAttachment(g,h)})}}})}(window,window.angular);